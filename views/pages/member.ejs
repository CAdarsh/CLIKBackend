<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,300;0,400;0,500;0,700;0,800;1,600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./styles.css" />
    <!-- <link rel="stylesheet" href="./dashboard.css" /> -->
    <link rel="stylesheet" href="./member.css" />
    <title>Document</title>
  </head>
  <body>
    <style>
      .none{
        display: none;
      }
    </style>
    <!-- The core Firebase JS SDK is always required and must be listed first -->


    <script>
      function ChangeData(data) {
        let {
          content,
          bEmail,
          bPhone,
          website,
          title,
          location,
          slug,
          image,
          products
        } = data;
        document.querySelector(".info-name").innerHTML = title;
        document.querySelector(".location").innerHTML = location;
        document.querySelector(".contact-email").href = `mailto:${bEmail}`;
        document.querySelector(".contact-website").href = website;
        document.querySelector(".contact-phone").href = `tel:+${bPhone}`;
        document.querySelector(".about-text").innerHTML = content;
        document.querySelector("#img-main").src = `${image.split('\\')[1]}/${image.split('\\')[2]}`;
        products.map((data,index)=>{
          let a =  `<div class="product">
          <img class="product-img opac" src="${data.image}" alt="product">
          <div class="hnp opac">
            <h3 class="product-heading">${data.name}</h3>
            <p class="product-price">${!!data.price?'&#8377;':''} ${(!data.price?'Contact Us':data.price)} </p>
            <p class="product-desc">${data.desc?data.desc:''}</p>
            </div>
          <img src="/images/delete.svg" alt="delete" class="delete-svg" onclick="deleteUser('${data._id}')"/>
        </div>  `
        
        if(index == 0){
            document.querySelector('.products').innerHTML = a;
          }
          else{
            document.querySelector('.products').innerHTML += a;
          }
        })

        // document.querySelector('.products').innerHTML += a;
        document.querySelector('.products').innerHTML += ` </div>  
        <div class="product add-product-btn">
          <p>+</p>
        </div>`;

        document.querySelector(".add-product-btn").addEventListener("click", () => {
          document.querySelector(".new-entry-modal-cont").style.display = "grid";
        });
      }
      let token = sessionStorage.getItem("token");
      if (token && token != "undefined") {
        var myHeaders = new Headers();
        myHeaders.append("Authorization", `Bearer ${token}`); 
        var raw = "";
        var requestOptions = {
          method: "GET",
          headers: myHeaders,
          redirect: "follow",
        };

        fetch("/member/details", requestOptions)
          .then((response) => response.json())
          .then((result) => {
            console.log(result);
            document.querySelector('.spinner').style.display="none"
            ChangeData(result);
            document.forms.addProduct.token.value = token;
          })
          .catch((error) => console.log("error", error));
      } else {
        window.location = "/member";
      }

      function deleteUser(id){
        let Header = new Headers();
        let data = {id:id};
        console.log(JSON.stringify(data))
        Header.append("Authorization", `Bearer ${token}`);
        Header.append("Content-Type", `application/json`);
        var requestOptions = {
          method: "DELETE",
          headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": `application/json`
          },
          body: JSON.stringify(data),
          redirect: "follow",
        };

        fetch("/member/product", requestOptions)
          .then((response) => response.json())
          .then((result) => {
            console.log(result);
            window.location = '/member/page';
            // ChangeData(result);
          })
          .catch((error) => console.log("error", error));
      }
    </script>

    <%- include('../partials/header') %>
    <div class="new-entry-modal-cont">
      <div class="new-entry-modal">
        <div class="new-entry-cross">x</div>
        <h2 class="new-entry-heading">New Entry</h2>
        <form action="/member/product" name="addProduct" method="POST" enctype='multipart/form-data' class="new-entry-form">
          <input type="file" name="product" id="file" class="inputfile" accept=".jpeg,.jpg,.png,.svg" required/>
          <label for="file"><svg width="65" height="44" viewBox="0 0 65 44" fill="none" xmlns="http://www.w3.org/2000/svg" class="upload-svg">
            <path d="M52.4062 16.61C50.5646 7.1225 42.3583 0 32.5 0C24.6729 0 17.875 4.51 14.4896 11.11C6.3375 11.99 0 19.0025 0 27.5C0 36.6025 7.28542 44 16.25 44H51.4583C58.9333 44 65 37.84 65 30.25C65 22.99 59.4479 17.105 52.4062 16.61ZM37.9167 24.75V35.75H27.0833V24.75H18.9583L32.5 11L46.0417 24.75H37.9167Z" fill="white"/>
            </svg> Choose Product Image</label>
            <input type="text" name="token" class="none">
          <input type="text" class="pn" name="name" placeholder="Product Name" required/> 
          <input type="text" class="pp" name="price" placeholder="Product Price (optional)" />
          <textarea class="pd" name="desc" rows="4" placeholder="Product description (under 170 characters)"></textarea>
          <input type="submit" class="new-entry-submit" value="Add" />
        </form>
      </div>
    </div>
    <main>
      <div class="inner-nav">
          <div class="company-logo"><img src="./images/ph.png" alt="logo" id="img-main" class="company-logo-img"></div>
          <div class="company-info"> 
              <div class="company-name-loc">
                  <h1 class="company-name info-name"></h2>
                  <p class="company-loc location"><img class="company-loc-img" src="./images/pin.svg" alt="pin"> Mathikere, Bengaluru</p>
              </div>
              <div class="company-nav">
                  <button class="company-nav-button btn-abt">About</button>
                  <button class="company-nav-button btn-pro">Products</button>
                  <button class="company-nav-button btn-con">Contact</button>
              </div>
              <button class="company-edit">Edit</button>
          </div>
      </div>
      <div class="edit-feedback">
          <div class="edit-feed-text">
              Edit Complete
          </div>
      </div>
      <div class="spinner">
        <div class="bounce1"></div>
        <div class="bounce2"></div>
        <div class="bounce3"></div>
      </div>
      <div class="about">
          <p class="about-text"></p>
      </div>
      <div class="products">
        <!-- <div class="product add-product-btn">
          <p>+</p>
        </div> -->
      </div>
      <div class="contact">
          <div class="contact-info">
              <a href="#" class="contact-phone"><img class="contact-info-img" src="./images/phone.svg" alt="">+91 99889 99988</a>
              <a href="#" class="contact-email"><img class="contact-info-img" src="./images/email.svg" alt=""> johndoe@company.com</a>
              <a href="#" class="contact-website"><img 
                  class="contact-info-img" src="./images/internet.svg" alt=""> www.johndoe.com</a>
          </div>
          <div class="contact-address">
              Please contact us through one of these mediums  
          </div>
      </div>
  </main>
    <%- include('../partials/footer') %>
    <script src="./index.js"></script>
    <script src="./member.js"></script>
  </body>
</html>
